<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wikipedia Fuzzy Image Browser</title>
<style>
  body { font-family: Arial, sans-serif; background: #f8f8f8; padding: 20px; }
  h1 { text-align: center; }
  textarea { width: 100%; height: 120px; font-size: 16px; padding: 10px; }
  button { margin-top: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
  #results { display: flex; flex-direction: column; align-items: center; margin-top: 25px; gap: 25px; }

  .card {
    position: relative; background: #fff; width: 320px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    border-radius: 10px; overflow: hidden; text-align: center; transition: transform 0.2s;
  }
  .card:hover { transform: scale(1.02); }

  .image-container { position: relative; width: 100%; height: 240px; overflow: hidden; }
  .image-container img { width: 100%; height: 240px; object-fit: cover; display: block; }

  .desc {
    position: absolute; bottom: 0; left: 0; right: 0;
    background: rgba(0,0,0,0.75); color: white; padding: 10px;
    opacity: 0; transition: opacity 0.3s; pointer-events: none;
  }
  .image-container:hover .desc { opacity: 1; }

  .controls { display: flex; justify-content: space-between; padding: 10px 20px 15px; }
  .controls button {
    background: #007bff; border: none; color: white; padding: 6px 12px;
    border-radius: 5px; cursor: pointer;
  }
  .controls button:hover { background: #0056b3; }
</style>
</head>
<body>

<h1>Wikipedia Fuzzy Image Browser</h1>

<textarea id="inputText" placeholder="Enter text (e.g. red fox with tail,  big cat.  flying pig.)"></textarea><br>
<button onclick="searchWiki()">Search</button>

<div id="results"></div>

<script>
async function searchWiki() {
  const input = document.getElementById('inputText').value.trim();

  // --- SPLITTING RULES ---
  // 1. Split by commas, dots, or two+ spaces
  // 2. Keep single spaces within a phrase (limit each to max 4 spaces)
  let rawWords = input.split(/(?:,|\.\s*| {2,})+/).map(w => w.trim()).filter(Boolean);

  // Enforce max 4 spaces per phrase (so 5 words total)
  const words = rawWords.map(w => {
    const parts = w.split(/\s+/);
    if (parts.length > 5) {
      return parts.slice(0, 5).join(' ');
    }
    return w;
  });

  const resultsDiv = document.getElementById('results');
  resultsDiv.innerHTML = '';

  for (const word of words) {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `<h3>${word}</h3><p>Searching...</p>`;
    resultsDiv.appendChild(card);

    try {
      // Fuzzy search for the word
      const searchRes = await fetch(
        `https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(word)}&utf8=&format=json&origin=*`
      );
      const searchData = await searchRes.json();
      if (!searchData.query.search.length) {
        card.innerHTML = `<h3>${word}</h3><p>No result found.</p>`;
        continue;
      }

      const bestTitle = searchData.query.search[0].title;

      // Get summary
      const summaryRes = await fetch(
        `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(bestTitle)}`
      );
      const summaryData = await summaryRes.json();
      const description = summaryData.extract || "No description available.";

      // Get multiple images
      const imageRes = await fetch(
        `https://en.wikipedia.org/w/api.php?action=query&titles=${encodeURIComponent(bestTitle)}&prop=images&format=json&origin=*`
      );
      const imageData = await imageRes.json();
      const page = Object.values(imageData.query.pages)[0];
      const images = (page.images || [])
        .map(img => img.title)
        .filter(t => /\.(jpg|jpeg|png|gif)$/i.test(t))
        .slice(0, 10);

      let imageUrls = [];
      for (const imgTitle of images) {
        const imageInfoRes = await fetch(
          `https://en.wikipedia.org/w/api.php?action=query&titles=${encodeURIComponent(imgTitle)}&prop=imageinfo&iiprop=url&format=json&origin=*`
        );
        const infoData = await imageInfoRes.json();
        const filePage = Object.values(infoData.query.pages)[0];
        if (filePage?.imageinfo?.[0]?.url) {
          imageUrls.push(filePage.imageinfo[0].url);
        }
      }

      // Fallback thumbnail
      if (imageUrls.length === 0 && summaryData.thumbnail) {
        imageUrls = [summaryData.thumbnail.source];
      }

      if (imageUrls.length === 0) {
        card.innerHTML = `<h3>${bestTitle}</h3><p>No images found.</p>`;
        continue;
      }

      let index = 0;
      const imgContainer = document.createElement('div');
      imgContainer.className = 'image-container';

      const imgEl = document.createElement('img');
      imgEl.src = imageUrls[index];
      imgContainer.appendChild(imgEl);

      const descEl = document.createElement('div');
      descEl.className = 'desc';
      descEl.textContent = description;
      imgContainer.appendChild(descEl);

      const controls = document.createElement('div');
      controls.className = 'controls';

      const prevBtn = document.createElement('button');
      prevBtn.textContent = 'Previous';
      prevBtn.onclick = () => {
        index = (index - 1 + imageUrls.length) % imageUrls.length;
        imgEl.src = imageUrls[index];
      };

      const nextBtn = document.createElement('button');
      nextBtn.textContent = 'Next';
      nextBtn.onclick = () => {
        index = (index + 1) % imageUrls.length;
        imgEl.src = imageUrls[index];
      };

      controls.appendChild(prevBtn);
      controls.appendChild(nextBtn);

      card.innerHTML = `<h3>${bestTitle}</h3>`;
      card.appendChild(imgContainer);
      card.appendChild(controls);

    } catch (error) {
      console.error(error);
      card.innerHTML = `<h3>${word}</h3><p>Error fetching data.</p>`;
    }
  }
}
</script>

</body>
</html>
